<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ожидание результата...</title>
</head>
<body>
  <div id="status">Ищем ваш результат...</div>

  <script>
    const statusEl = document.getElementById("status");

    // Получаем имя файла из URL, например ?file=result-abc123.html
    const params = new URLSearchParams(window.location.search);
    const targetFile = params.get("file");

    if (!targetFile) {
      statusEl.textContent = "Ошибка: не указан файл для проверки.";
      throw new Error("Missing ?file= параметр");
    }

    async function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    async function checkFileExists(url) {
      try {
        const res = await fetch(url, { cache: "no-store" });
        return res.ok;
      } catch {
        return false;
      }
    }

    async function checkWithCountdown() {
      // Первая проверка
      if (await checkFileExists(targetFile)) {
        location.href = targetFile;
        return;
      }

      statusEl.textContent = "Файл пока не найден. Пробуем снова через 2 секунды...";
      await delay(2000);

      // Вторая проверка
      if (await checkFileExists(targetFile)) {
        location.href = targetFile;
        return;
      }

      // Обратный отсчёт
      for (let i = 10; i > 0; i--) {
        statusEl.textContent = `Ожидаем файл... Повтор через ${i} сек.`;
        await delay(1000);
      }

      // Третья проверка
      if (await checkFileExists(targetFile)) {
        location.href = targetFile;
      } else {
        statusEl.textContent = "Файл не найден. Попробуйте позже.";
      }
    }

    checkWithCountdown();
  </script>
</body>
</html>
